<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Projet — Hugo Daoust</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=13">
</head>
<body>
    <header>
        <a href="index.html">← Tous les projets</a>
    </header>
    <main id="project"></main>
    
    <!-- Neural network background with 3 layers -->
    <div class="concentric-squares"></div>
    
    <script src="data.js"></script>
    <script src="media/index.js"></script>
    <script src="neural-network.js"></script>
    <script>
        console.log('Script starting...');
        console.log('window.projects:', window.projects);
        console.log('window.mediaIndex:', window.mediaIndex);
        
        const projectList = (window.projects || []);
        const extra = (window.mediaIndex || {}).projects || {};
        const params = new URLSearchParams(location.search);
        const id = params.get("id");
        
        console.log('URL params:', location.search);
        console.log('Project ID:', id);
        console.log('Projects array length:', projectList.length);
        
        const p = projectList.find(x => x.id === id);
        const root = document.getElementById("project");
        
        console.log('Root element:', root);
        console.log('Found project:', p);
        
        function renderMedia(url, title) {
            try {
                let m;
                if ((m = url.match(/^https?:\/\/(?:www\.)?youtu\.be\/([\w-]+)/))) {
                    const vid = m[1];
                    return `<div class="media"><iframe width="560" height="315" src="https://www.youtube.com/embed/${vid}" title="${title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>`;
                }
                if ((m = url.match(/^https?:\/\/(?:www\.)?youtube\.com\/(?:watch\?v=|shorts\/)([\w-]+)/))) {
                    const vid = m[1];
                    return `<div class="media"><iframe width="560" height="315" src="https://www.youtube.com/embed/${vid}" title="${title}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>`;
                }
                if ((m = url.match(/^https?:\/\/(?:www\.)?vimeo\.com\/(\d+)/))) {
                    const vid = m[1];
                    return `<div class="media"><iframe src="https://player.vimeo.com/video/${vid}" width="640" height="360" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe></div>`;
                }
                const isVideo = /\.(mp4|webm|mov)$/i.test(url);
                return isVideo ? `<video controls src="${url}" preload="metadata"></video>` : `<img loading="lazy" src="${url}" alt="${title}">`;
            } catch (e) {
                return `<a target="_blank" rel="noopener" href="${url}">${url}</a>`;
            }
        }
        
        if (!p) {
            root.innerHTML = `<p>Projet introuvable.</p>`;
            console.log('Project not found for ID:', id);
        } else {
            console.log('Project found:', p.title);
            // Use fullDescription if available, otherwise fall back to description
            const mainDescription = p.fullDescription || p.description || "";
            
            // Create description HTML - pure text flow, no special treatment
            let descHtml;
            if (p.fullDescription) {
                // Format fullDescription with proper structure
                const formattedDesc = mainDescription
                    .replace(/\\n/g, '\n')  // Convert \n to actual line breaks
                    .split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
                
                let html = '';
                let inBulletList = false;
                
                for (let i = 0; i < formattedDesc.length; i++) {
                    const line = formattedDesc[i];
                    
                    if (line.startsWith('- ')) {
                        // Bullet point - start list if not already in one
                        if (!inBulletList) {
                            html += `<ul class="bullet-list">`;
                            inBulletList = true;
                        }
                        html += `<li>${line.substring(2)}</li>`;
                    } else if (line.startsWith('**') && line.endsWith('**')) {
                        // Section header - bold text (markdown format)
                        if (inBulletList) {
                            html += `</ul>`;
                            inBulletList = false;
                        }
                        const headerText = line.substring(2, line.length - 2);
                        html += `<h3>${headerText}</h3>`;
                    } else if (line === 'Technical details and implementation' || 
                               line === 'Challenges and solutions' || 
                               line === 'Impact and results' || 
                               line === 'Process and methodology') {
                        // Section header - plain text format
                        if (inBulletList) {
                            html += `</ul>`;
                            inBulletList = false;
                        }
                        html += `<h3>${line}</h3>`;
                    } else if (line.length > 0) {
                        // Everything else is just a regular paragraph
                        if (inBulletList) {
                            html += `</ul>`;
                            inBulletList = false;
                        }
                        html += `<p class="desc">${line}</p>`;
                    }
                }
                
                // Close any open list
                if (inBulletList) {
                    html += `</ul>`;
                }
                
                descHtml = html;
            } else {
                // Fallback for regular description
                const bullets = mainDescription.split(/\r?\n|•|\s-\s|, /).map(s => s.trim()).filter(Boolean);
                descHtml = bullets.length > 1 ? 
                    `<ul>` + bullets.map(b => `<li>${b}</li>`).join("") + `</ul>` : 
                    `<p class="desc">${mainDescription}</p>`;
            }
            
            
            // Simple text-only content
            
            
            
            
            
            // Get Instagram links
            const insta = (p.instagram || []).map(u => `<a target="_blank" rel="noopener" href="${u}">Instagram</a>`).join(" · ");
            
            // Render the project page - clean version
            const htmlContent = `
                <article>
                    <h1>${p.title}</h1>
                    <p class="meta">${[p.year, p.client, p.role].filter(Boolean).join(" · ")}</p>
                    <p class="tech">${p.technologies || ""}</p>
                    <div class="project-content">
                        ${descHtml}
                    </div>
                    <p class="links">${insta}</p>
                </article>
            `;
            
            console.log('Setting HTML content for project:', p.title);
            console.log('HTML length:', htmlContent.length);
            root.innerHTML = htmlContent;
        }
        
        // Interactive controls removed

        // Click outside to go back feature removed to avoid conflicts with image manipulation
        
        // Initialize the 3-layer dotted background with mouse parallax
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing background...');
            console.log('generateConcentricSquares available:', typeof generateConcentricSquares);
            console.log('initParallaxEffect available:', typeof initParallaxEffect);
            
            if (typeof generateConcentricSquares === 'function') {
                generateConcentricSquares();
                console.log('generateConcentricSquares called successfully');
            } else {
                console.error('generateConcentricSquares function not found');
            }
            
            if (typeof initParallaxEffect === 'function') {
                initParallaxEffect();
                console.log('initParallaxEffect called successfully');
            } else {
                console.error('initParallaxEffect function not found');
            }
        });
        
        // Also initialize if DOM is already loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                console.log('DOM was loading, now ready...');
                if (typeof generateConcentricSquares === 'function') {
                    generateConcentricSquares();
                }
                if (typeof initParallaxEffect === 'function') {
                    initParallaxEffect();
                }
            });
        } else {
            console.log('DOM already loaded, initializing immediately...');
            if (typeof generateConcentricSquares === 'function') {
                generateConcentricSquares();
            }
            if (typeof initParallaxEffect === 'function') {
                initParallaxEffect();
            }
        }
        
        // Regenerate squares on window resize
        window.addEventListener('resize', function() {
            console.log('Window resized, regenerating background...');
            if (typeof generateConcentricSquares === 'function') {
                generateConcentricSquares();
            }
            setTimeout(() => {
                if (typeof initParallaxEffect === 'function') {
                    initParallaxEffect();
                }
            }, 100);
        });
        
        // Debug: Check if container exists
        setTimeout(() => {
            const container = document.querySelector('.concentric-squares');
            console.log('Container found:', !!container);
            if (container) {
                console.log('Container children:', container.children.length);
            }
        }, 1000);
    </script>
</body>
</html>